!function(i){i.isScrollToFixed=function(o){return void 0!==i(o).data("ScrollToFixed")},i.ScrollToFixed=function(o,t){function e(){T.trigger("preUnfixed"),f(),T.trigger("unfixed"),m=-1,S=T.offset().top,h=T.offset().left,a.options.offsets&&(h+=T.offset().left-T.position().left),-1==w&&(w=h),b=T.css("position"),F=!0,-1!=a.options.bottom&&(T.trigger("preFixed"),l(),T.trigger("fixed"))}function n(){var i=a.options.limit;return i?"function"==typeof i?i():i:0}function r(){return"fixed"===b}function d(){return"absolute"===b}function s(){return!(r()||d())}function l(){r()||(v.css({display:T.css("display"),width:T.outerWidth(!0),height:T.outerHeight(!0),"float":T.css("float")}),T.css({width:T.width(),position:"fixed",top:-1==a.options.bottom?c():"",bottom:-1==a.options.bottom?"":a.options.bottom}),b="fixed")}function p(){T.css({width:T.width(),position:"absolute",top:n(),left:h}),b="absolute"}function f(){s()||(m=-1,v.css("display","none"),T.css({width:"",position:"",left:"",top:""}),b=null)}function x(i){i!=m&&(T.css("left",h-i),m=i)}function c(){return a.options.marginTop}function u(){if(i.isScrollToFixed(T)){var o=F;F||e();var t=i(window).scrollLeft(),u=i(window).scrollTop(),b=n();a.options.minWidth&&i(window).width()<a.options.minWidth?s()&&o||(g(),T.trigger("preUnfixed"),f(),T.trigger("unfixed")):-1==a.options.bottom?b>0&&u>=b-c()?d()&&o||(g(),T.trigger("preAbsolute"),p(),T.trigger("unfixed")):u>=S-c()?(r()&&o||(g(),T.trigger("preFixed"),l(),m=-1,T.trigger("fixed")),x(t)):s()&&o||(g(),T.trigger("preUnfixed"),f(),T.trigger("unfixed")):b>0?u+i(window).height()-T.outerHeight(!0)>=b-c()?r()&&(g(),T.trigger("preUnfixed"),f(),T.trigger("unfixed")):(r()||(g(),T.trigger("preFixed"),l()),x(t),T.trigger("fixed")):x(t)}}function g(){var i=T.css("position");"absolute"==i?T.trigger("postAbsolute"):"fixed"==i?T.trigger("postFixed"):T.trigger("postUnfixed")}var a=this;a.$el=i(o),a.el=o,a.$el.data("ScrollToFixed",a);var b,F=!1,T=a.$el,S=0,h=0,w=-1,m=-1,v=null,U=function(){T.is(":visible")&&(F=!1,u())},A=function(){u()};a.init=function(){a.options=i.extend({},i.ScrollToFixed.defaultOptions,t),("iPad"!==navigator.platform&&"iPhone"!==navigator.platform&&"iPod"!==navigator.platform||navigator.userAgent.match(/OS 5_.*\ like Mac OS X/i))&&(a.$el.css("z-index",a.options.zIndex),v=i("<div />"),b=T.css("position"),s()&&a.$el.after(v),i(window).bind("resize.ScrollToFixed",U),i(window).bind("scroll.ScrollToFixed",A),a.options.preFixed&&T.bind("preFixed.ScrollToFixed",a.options.preFixed),a.options.postFixed&&T.bind("postFixed.ScrollToFixed",a.options.postFixed),a.options.preUnfixed&&T.bind("preUnfixed.ScrollToFixed",a.options.preUnfixed),a.options.postUnfixed&&T.bind("postUnfixed.ScrollToFixed",a.options.postUnfixed),a.options.preAbsolute&&T.bind("preAbsolute.ScrollToFixed",a.options.preAbsolute),a.options.postAbsolute&&T.bind("postAbsolute.ScrollToFixed",a.options.postAbsolute),a.options.fixed&&T.bind("fixed.ScrollToFixed",a.options.fixed),a.options.unfixed&&T.bind("unfixed.ScrollToFixed",a.options.unfixed),a.options.spacerClass&&v.addClass(a.options.spacerClass),T.bind("resize.ScrollToFixed",function(){v.height(T.height())}),T.bind("scroll.ScrollToFixed",function(){T.trigger("preUnfixed"),f(),T.trigger("unfixed"),u()}),T.bind("remove.ScrollToFixed",function(){T.trigger("preUnfixed"),f(),T.trigger("unfixed"),i(window).unbind("resize.ScrollToFixed",U),i(window).unbind("scroll.ScrollToFixed",A),T.unbind(".ScrollToFixed"),a.$el.removeData("ScrollToFixed")}),U())},a.init()},i.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3},i.fn.scrollToFixed=function(o){return this.each(function(){new i.ScrollToFixed(this,o)})}}(jQuery);
